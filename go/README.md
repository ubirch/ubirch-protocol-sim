# ubirch protocol SIM interface for Go

```
cd main
go run main.go /dev/ttyUSB0 115200
``` 

Running requires a configuration file: `main/config.json` which must contain at least the `"password"`-key. This is the
 ubirch API auth token from the 
```json
{
  "password": "<ubirch-api-token>"
}
```

There are default values for all service URLs. The default ubirch environment stage is `"prod"`, but can be overwritten
 with the `"env"`-key. Extended debug output can be enabled with the `"debug"`-key.
```json
{
  "password": "<ubirch-api-token>",
  "env": "dev",
  "debug": true
}
```
> To test this implementation with a Pycom Gpy, install the [uart proxy](proxy) and then run main.go
>  with the corresponding connection to the USB serial interface:

Example output:
```
2019/08/16 16:35:20 SIM Interface Example
2019/08/16 16:35:20 +++ AT+CFUN? (8)
2019/08/16 16:35:21 --- +CFUN: 4 (8)
2019/08/16 16:35:21 --- OK (2)
2019/08/16 16:35:21 SIM applet select
2019/08/16 16:35:21 +++ AT+CSIM=42,"00A4040010D2760001180002FF34108389C0028B02" (55)
2019/08/16 16:35:21 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:21 --- OK (2)
2019/08/16 16:35:21 SIM authenticating
2019/08/16 16:35:21 +++ AT+CSIM=18,"002000000431323334" (31)
2019/08/16 16:35:21 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:21 --- OK (2)
2019/08/16 16:35:21 ENC tag=0xc4, len=  2 [02], data=5f42
2019/08/16 16:35:21 ENC tag=0xc0, len= 16 [10], data=848db5dd65644f7dafae46325db8dfff
2019/08/16 16:35:21 ENC tag=0xc1, len=  1 [01], data=03
2019/08/16 16:35:21 ENC tag=0xc4, len=  1 [01], data=42
2019/08/16 16:35:21 ENC tag=0xc0, len= 16 [10], data=848db5dd65644f7dafae46325db8dfff
2019/08/16 16:35:21 ENC tag=0xc1, len=  1 [01], data=03
2019/08/16 16:35:21 +++ AT+CSIM=108,"80B2800031C4025F42C010848DB5DD65644F7DAFAE46325DB8DFFFC10103C40142C010848DB5DD65644F7DAFAE46325DB8DFFFC10103" (122)
2019/08/16 16:35:22 --- +CSIM: 4,6A80 (13)
2019/08/16 16:35:22 --- OK (2)
2019/08/16 16:35:22 key may already exist: APDU error: 6a80, generate key failed
2019/08/16 16:35:22 +++ AT+CSIM=14,"80A50000025f42" (27)
2019/08/16 16:35:22 --- +CSIM: 4,6117 (13)
2019/08/16 16:35:22 --- OK (2)
2019/08/16 16:35:22 +++ AT+CSIM=10,"00C0000017" (23)
2019/08/16 16:35:22 --- +CSIM: 50,C4025F42C0115F848DB5DD65644F7DAFAE46325DB8DFFF9000 (60)
2019/08/16 16:35:22 --- OK (2)
2019/08/16 16:35:22 ENC tag=0xd0, len=  1 [01], data=00
2019/08/16 16:35:22 +++ AT+CSIM=16,"80CB000003D00100" (29)
2019/08/16 16:35:22 --- +CSIM: 4,6148 (13)
2019/08/16 16:35:22 --- OK (2)
2019/08/16 16:35:22 +++ AT+CSIM=10,"00C0000048" (23)
2019/08/16 16:35:23 --- +CSIM: 148,C2030B0100C341046885A435CA4E60C9C87735FE613A5BD5D702C91DF9A87057192120494054BF867318D629E3B9009C0C662792A6E8E414CF1F6AB2A4A94225C7A81C1BA37855B19000 (159)
2019/08/16 16:35:23 --- OK (2)
2019/08/16 16:35:23 DEC tag=0xc2, len=  3 [03], data=0b0100
2019/08/16 16:35:23 DEC tag=0xc3, len= 65 [41], data=046885a435ca4e60c9c87735fe613a5bd5d702c91df9a87057192120494054bf867318d629e3b9009c0c662792a6e8e414cf1f6ab2a4a94225c7a81c1ba37855b1
2019/08/16 16:35:23 {"algorithm":"ecdsa-p256v1","created":"2019-08-16T16:35:23.043Z","hwDeviceId":"848db5dd-6564-4f7d-afae-46325db8dfff","pubKey":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","pubKeyId":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","validNotAfter":"2020-08-15T16:35:23.043Z","validNotBefore":"2019-08-16T16:35:23.043Z"}
2019/08/16 16:35:23 ENC tag=0xc4, len=  1 [01], data=42
2019/08/16 16:35:23 ENC tag=0xd0, len=  1 [01], data=21
2019/08/16 16:35:23 +++ AT+CSIM=22,"80B5000006C40142D00121" (35)
2019/08/16 16:35:23 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:23 --- OK (2)
2019/08/16 16:35:23 +++ AT+CSIM=138,"80B60000407b22616c676f726974686d223a2265636473612d703235367631222c2263726561746564223a22323031392d30382d31365431363a33353a32332e3034335a22" (152)
2019/08/16 16:35:24 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:24 --- OK (2)
2019/08/16 16:35:24 +++ AT+CSIM=138,"80B60000402c2268774465766963654964223a2238343864623564642d363536342d346637642d616661652d343633323564623864666666222c227075624b6579223a2261" (152)
2019/08/16 16:35:24 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:24 --- OK (2)
2019/08/16 16:35:24 +++ AT+CSIM=138,"80B600004049576b4e63704f594d6e49647a582b59547062316463437952333571484258475345675355425576345a7a474e597034376b416e41786d4a354b6d364f51557a" (152)
2019/08/16 16:35:24 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:24 --- OK (2)
2019/08/16 16:35:24 +++ AT+CSIM=138,"80B60000407839717371537051695848714277626f33685673513d3d222c227075624b65794964223a226149576b4e63704f594d6e49647a582b5954706231646343795233" (152)
2019/08/16 16:35:24 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:24 --- OK (2)
2019/08/16 16:35:24 +++ AT+CSIM=138,"80B60000403571484258475345675355425576345a7a474e597034376b416e41786d4a354b6d364f51557a7839717371537051695848714277626f33685673513d3d222c22" (152)
2019/08/16 16:35:25 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:25 --- OK (2)
2019/08/16 16:35:25 +++ AT+CSIM=138,"80B600004076616c69644e6f744166746572223a22323032302d30382d31355431363a33353a32332e3034335a222c2276616c69644e6f744265666f7265223a2232303139" (152)
2019/08/16 16:35:25 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:25 --- OK (2)
2019/08/16 16:35:25 +++ AT+CSIM=54,"80B68000162d30382d31365431363a33353a32332e3034335a227d" (67)
2019/08/16 16:35:26 --- +CSIM: 4,6147 (13)
2019/08/16 16:35:26 --- OK (2)
2019/08/16 16:35:26 +++ AT+CSIM=10,"00C0000047" (23)
2019/08/16 16:35:26 --- +CSIM: 146,3045022100D44296B3DAE83B6BB1A07E811C76F9EECC490708D3BA56410D359F48DE77768F022001C884543AE43EA8420C6AB17783C35EEA92F29175F01BE1584288407FF614829000 (157)
2019/08/16 16:35:26 --- OK (2)
2019/08/16 16:35:26 certificate: {"pubKeyInfo":{"algorithm":"ecdsa-p256v1","created":"2019-08-16T16:35:23.043Z","hwDeviceId":"848db5dd-6564-4f7d-afae-46325db8dfff","pubKey":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","pubKeyId":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","validNotAfter":"2020-08-15T16:35:23.043Z","validNotBefore":"2019-08-16T16:35:23.043Z"},"signature":"ANRClrPa6DtrsaB+gRx2+e7MSQcI07pWQQ01n0jed3aPAciEVDrkPqhCDGqxd4PDXuqS8pF18BvhWEKIQH/2FII="}
2019/08/16 16:35:26 response: {"pubKeyInfo":{"algorithm":"ecdsa-p256v1","created":"2019-08-07T13:27:27.000Z","hwDeviceId":"848db5dd-6564-4f7d-afae-46325db8dfff","pubKey":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","pubKeyId":"aIWkNcpOYMnIdzX+YTpb1dcCyR35qHBXGSEgSUBUv4ZzGNYp47kAnAxmJ5Km6OQUzx9qsqSpQiXHqBwbo3hVsQ==","validNotAfter":"2020-07-28T13:27:27.000Z","validNotBefore":"2019-08-07T13:27:27.000Z"},"signature":"O36t9AAVoJE+eszbpLbdxvo30hYaguB4SJXJdzTL8Fb0+TmsJ7NPAe9wzq9M3/Ey6fpzZZRwz9m57e/Y3SqlZg=="}
2019/08/16 16:35:26 +++ AT+CSIM=14,"80A50000025f42" (27)
2019/08/16 16:35:27 --- +CSIM: 4,6117 (13)
2019/08/16 16:35:27 --- OK (2)
2019/08/16 16:35:27 +++ AT+CSIM=10,"00C0000017" (23)
2019/08/16 16:35:27 --- +CSIM: 50,C4025F42C0115F848DB5DD65644F7DAFAE46325DB8DFFF9000 (60)
2019/08/16 16:35:27 --- OK (2)
2019/08/16 16:35:27 ENC tag=0xd0, len=  1 [01], data=00
2019/08/16 16:35:27 +++ AT+CSIM=16,"80CB000003D00100" (29)
2019/08/16 16:35:27 --- +CSIM: 4,6148 (13)
2019/08/16 16:35:27 --- OK (2)
2019/08/16 16:35:27 +++ AT+CSIM=10,"00C0000048" (23)
2019/08/16 16:35:27 --- +CSIM: 148,C2030B0100C341046885A435CA4E60C9C87735FE613A5BD5D702C91DF9A87057192120494054BF867318D629E3B9009C0C662792A6E8E414CF1F6AB2A4A94225C7A81C1BA37855B19000 (159)
2019/08/16 16:35:27 --- OK (2)
2019/08/16 16:35:27 DEC tag=0xc2, len=  3 [03], data=0b0100
2019/08/16 16:35:27 DEC tag=0xc3, len= 65 [41], data=046885a435ca4e60c9c87735fe613a5bd5d702c91df9a87057192120494054bf867318d629e3b9009c0c662792a6e8e414cf1f6ab2a4a94225c7a81c1ba37855b1
2019/08/16 16:35:27 public key: 6885a435ca4e60c9c87735fe613a5bd5d702c91df9a87057192120494054bf867318d629e3b9009c0c662792a6e8e414cf1f6ab2a4a94225c7a81c1ba37855b1
2019/08/16 16:35:27 {"Timestamp":1565966127,"Value":2596996162}
2019/08/16 16:35:27 payload hash: base64 cu8S3PxlxQxM1KZdJeo2Q6hzpymRIrgTvJl/ijxesBA=
2019/08/16 16:35:27 payload hash: hex    72ef12dcfc65c50c4cd4a65d25ea3643a873a7299122b813bc997f8a3c5eb010
2019/08/16 16:35:27 ENC tag=0xc4, len=  1 [01], data=42
2019/08/16 16:35:27 ENC tag=0xd0, len=  1 [01], data=21
2019/08/16 16:35:27 +++ AT+CSIM=22,"80B5220006C40142D00121" (35)
2019/08/16 16:35:28 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:28 --- OK (2)
2019/08/16 16:35:28 +++ AT+CSIM=74,"80B680002072ef12dcfc65c50c4cd4a65d25ea3643a873a7299122b813bc997f8a3c5eb010" (87)
2019/08/16 16:35:29 --- +CSIM: 4,6179 (13)
2019/08/16 16:35:29 --- OK (2)
2019/08/16 16:35:29 +++ AT+CSIM=10,"00C0000079" (23)
2019/08/16 16:35:29 --- +CSIM: 246,9522C410848DB5DD65644F7DAFAE46325DB8DFFF00C42072EF12DCFC65C50C4CD4A65D25EA3643A873A7299122B813BC997F8A3C5EB010C4408FB5261EB18196BD78108562463B84C70237BF889036C88BB177B627D196F2B4E700F8BB81B54F858F45FE3EDA34EF411F103787E9BF372CD5654A7C24B93BE59000 (257)
2019/08/16 16:35:29 --- OK (2)
2019/08/16 16:35:29 upp: 9522c410848db5dd65644f7dafae46325db8dfff00c42072ef12dcfc65c50c4cd4a65d25ea3643a873a7299122b813bc997f8a3c5eb010c4408fb5261eb18196bd78108562463b84c70237bf889036c88bb177b627d196f2b4e700f8bb81b54f858f45fe3eda34ef411f103787e9bf372cd5654a7c24b93be5
2019/08/16 16:35:30 response: 9522c4109d3c78ff22f34441a5d185c636d486ff0081a76d657373616765bf796f7572207265717565737420686173206265656e207375626d6974746564c4406af8ad7375ae7723fffe19adc2a0e6c6c021c6e0b27b9bfe2f3e332d640496c4ad9b9d70f3bb90f38e916c0da3eecdfe317279999d5fe15e4857ce21db27fe08
2019/08/16 16:35:30 ENC tag=0xc4, len=  2 [02], data=5f42
2019/08/16 16:35:30 ENC tag=0xd0, len=  1 [01], data=21
2019/08/16 16:35:30 +++ AT+CSIM=24,"80B7220007C4025F42D00121" (37)
2019/08/16 16:35:30 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:30 --- OK (2)
2019/08/16 16:35:30 +++ AT+CSIM=138,"80B80000409522c410848db5dd65644f7dafae46325db8dfff00c42072ef12dcfc65c50c4cd4a65d25ea3643a873a7299122b813bc997f8a3c5eb010c4408fb5261eb18196" (152)
2019/08/16 16:35:31 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:31 --- OK (2)
2019/08/16 16:35:31 +++ AT+CSIM=124,"80B8800039bd78108562463b84c70237bf889036c88bb177b627d196f2b4e700f8bb81b54f858f45fe3eda34ef411f103787e9bf372cd5654a7c24b93be5" (138)
2019/08/16 16:35:32 --- +CSIM: 4,9000 (13)
2019/08/16 16:35:32 --- OK (2)
2019/08/16 16:35:32 verification: true
```